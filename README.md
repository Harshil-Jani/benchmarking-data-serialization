# Data Serialization Performance Benchmark: JSON vs. Protobuf vs. FlatBuffers

This project provides a benchmark to compare the performance of three popular data serialization formats: JSON, Protocol Buffers (Protobuf), and FlatBuffers. The benchmark is written in Python and measures:

-   **Serialization Time:** How long it takes to encode a data structure into its on-the-wire format.
-   **Deserialization Time:** How long it takes to parse the data and access it.
-   **Data Size:** The final size of the serialized payload in bytes.

The script runs the benchmark 100 times and averages the results to provide a stable and reliable comparison, making it easy to understand the trade-offs between these formats.

## Prerequisites

Before you can run the benchmark, you need to ensure Python and the necessary schema compilers are installed on your system.

### Python

-   **Python 3.8+** is required.
-   You will also need **pip** for installing Python packages.

### Schema Compilers

You must install the compilers for both Protocol Buffers (`protoc`) and FlatBuffers (`flatc`).

#### 1. Protocol Buffers Compiler (`protoc`)

**On macOS (using Homebrew):**
```bash
brew install protobuf
```

**On Linux (Debian/Ubuntu):**
```bash
sudo apt update
sudo apt install -y protobuf-compiler
```

**On Windows (using Chocolatey, WinGet, or manual download):**
Using Chocolatey:
```powershell
choco install protoc
```
Using WinGet:
```powershell
winget install Google.ProtocolBuffers
```
For manual installation, download the latest `protoc-*-win64.zip` from the [Protobuf Releases page](https://github.com/protocolbuffers/protobuf/releases), extract it, and add the `bin` directory to your system's `PATH`.

**Verify installation:**
```bash
protoc --version
```
(Should return `libprotoc 3.x.x` or higher)

---

#### 2. FlatBuffers Compiler (`flatc`)

**On macOS (using Homebrew):**
```bash
brew install flatbuffers
```

**On Linux (Debian/Ubuntu):**
```bash
sudo apt update
sudo apt install -y flatbuffers-compiler
```

**On Windows (using Chocolatey or manual download):**
Using Chocolatey:
```powershell
choco install flatbuffers
```
For manual installation, download the `flatc.exe` for Windows from the [FlatBuffers Releases page](https://github.com/google/flatbuffers/releases), and add it to your system's `PATH`.

**Verify installation:**
```bash
flatc --version
```
(Should return `flatc version 2.x.x` or higher)


## Setup & Installation

Follow these steps to set up the project locally.

**1. Clone the Repository (or download the files):**
```bash
git clone https://github.com/Harshil-Jani/benchmarking-data-serialization
cd benchmarking-data-serialization
```

# TODO use pipenv yaar.
**2. Create and Populate `requirements.txt`:**
Create a file named `requirements.txt` and add the following lines:
```
numpy
protobuf
flatbuffers
```

**3. Install Python Dependencies:**
It's recommended to use a virtual environment.
```bash
# Create and activate a virtual environment (optional but recommended)
python -m venv venv
source venv/bin/activate  # On Windows, use `venv\Scripts\activate`

# Install the required packages
pip install -r requirements.txt
```

**4. Compile the Schemas:**
Run the schema compilers to generate the necessary Python code from the `.proto` and `.fbs` files.

**For Protobuf:**
```bash
protoc --python_out=. person.proto
```
This will generate `person_pb2.py`.

**For FlatBuffers:**
```bash
flatc --python person.fbs
```
This will generate a `MyData` directory containing the required Python modules.

Your project directory should now look like this:
```
.
├── MyData/                 # Generated by flatc
├── addressbook.fbs
├── benchmark_avg.py
├── person.proto
├── person_pb2.py           # Generated by protoc
├── README.md
└── requirements.txt
```

## Usage

Once the setup is complete, run the main benchmark script:

```bash
python benchmark_avg.py
```

The script will print its progress as it runs through 100 iterations and then display a formatted table with the final, averaged results.

### Example Output

```
--- Running Benchmark for 10000 records (100 runs) ---
Running iteration 100/100...
Benchmark runs complete.

--- Averaged Benchmark Results ---

Format          | Avg Serialization (s)    | Avg Deserialization (s)     | Avg Data Size (bytes)
-----------------------------------------------------------------------------------------------
JSON            | 0.048567                 | 0.021987                    | 1,788,901
Protobuf        | 0.021034                 | 0.014876                    | 1,288,901
FlatBuffers     | 0.034512                 | 0.000015                    | 1,360,048
```

## Our Blog Post

For a detailed analysis of these results and a discussion on when to choose each format, read our full article on Medium:

**[Benchmarking Data Serialization: JSON vs. Protobuf vs. Flatbuffers](https://medium.com/@harshiljani2002/benchmarking-data-serialization-json-vs-protobuf-vs-flatbuffers-3218eecdba77)**
